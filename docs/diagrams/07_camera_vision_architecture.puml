@startuml 07_camera_vision_architecture
!include _common.puml
title Camera → Geology (iPhone → Vertex AI) — Reference Architecture

left to right direction

package "iPhone (on-device)" as phone {
  rectangle "App UI\n(question + results)" as ui
  rectangle "Camera capture\n(1–3 photos)" as cam
  rectangle "GPS/EXIF + user note\n(optional)" as meta
  rectangle "Preflight\n(resize + quality checks)" as pre
}

package "GCP (cloud)" as gcp {
  rectangle "API (Cloud Run)\nAuth + rate limits" as api
  database "GCS\n(image blobs, optional)" as gcs
  rectangle "Vertex AI multimodal model\n(Gemini Vision)" as vlm
  rectangle "RAG Orchestrator\n(classification → retrieval)" as rag
  database "Vector store\n(Wikipedia slice / geology refs)" as vs
  rectangle "Observability\n(logs, traces)" as obs
}

cam --> pre
meta --> pre
ui --> pre : capture + context
pre --> api : HTTPS\n(OAuth / API key)

api --> gcs : optional upload
api --> vlm : classify + features\n(JSON schema)
api --> rag : build queries + retrieve
rag <--> vs : similarity search
vlm --> api : hypotheses + features
rag --> api : citations + explanation

api --> ui : response JSON + narration
api --> obs

@enduml

