<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="715px" preserveAspectRatio="none" style="width:1290px;height:715px;background:#FFFFFF;" version="1.1" viewBox="0 0 1290 715" width="1290px" zoomAndPan="magnify"><title>ANC &#8212; GCP / Vertex AI Architecture (Current)</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="23.3333" font-weight="bold" lengthAdjust="spacing" textLength="549.4727" x="358.6969" y="39.2253">ANC &#8212; GCP / Vertex AI Architecture (Current)</text></g><!--cluster local--><g class="cluster" data-qualified-name="local" data-source-line="6" id="ent0003"><polygon fill="none" points="51.6667,89.1471,68.3333,72.4805,490,72.4805,490,668.2138,473.3333,684.8805,51.6667,684.8805,51.6667,89.1471" style="stroke:#181818;stroke-width:1.6667;"/><line style="stroke:#181818;stroke-width:1.6667;" x1="473.3333" x2="490" y1="89.1471" y2="72.4805"/><line style="stroke:#181818;stroke-width:1.6667;" x1="51.6667" x2="473.3333" y1="89.1471" y2="89.1471"/><line style="stroke:#181818;stroke-width:1.6667;" x1="473.3333" x2="473.3333" y1="89.1471" y2="684.8805"/><text fill="#000000" font-family="sans-serif" font-size="23.3333" font-weight="bold" lengthAdjust="spacing" textLength="313.3138" x="107.5098" y="116.7057">Local dev (macOS / Linux)</text></g><!--cluster vertex--><g class="cluster" data-qualified-name="vertex" data-source-line="13" id="ent0008"><path d="M562.5838,521.0513 C574.6385,496.5035 592.5188,497.7674 608.4884,516.9409 C620.7716,496.4785 638.3929,493.3514 652.7369,514.7632 C671.7881,489.4167 689.3875,487.6623 706.4669,516.7109 C722.8789,492.7515 738.5932,496.9488 752.6152,519.1027 C764.2705,495.8626 781.8496,500.6773 795.2598,517.2216 C808.0935,491.4763 830.5938,489.6651 846.1675,514.4619 C861.876,489.619 881.9825,491.302 897.345,514.8279 C910.0824,496.3068 927.4645,494.0275 939.3573,515.7106 C951.1673,490.3826 971.2728,489.0262 985.8848,513.07 C1003.7963,489.2109 1022.2181,488.2043 1040.7044,512.4146 C1058.3556,491.7975 1075.5254,495.17 1088.5142,517.5937 C1104.4876,496.967 1120.0436,497.2679 1134.6082,519.1224 C1147.7301,495.6642 1162.3737,495.0118 1177.5885,517.1495 C1198.0777,492.0184 1226.2792,497.5819 1235,529.0805 C1240.4586,525.9711 1243.2315,528.3337 1243.8647,533.971 C1274.8315,551.3229 1277.6572,573.9479 1253.4079,599.3585 C1278.5331,631.4134 1264.3868,662.7596 1223.3333,664.0471 C1225.5679,665.6732 1226.3348,667.7725 1223.417,669.478 C1213.1087,694.2735 1195.8523,694.5683 1180.7694,673.9631 C1164.8882,696.5471 1143.5324,692.1832 1131.7196,669.55 C1121.1423,691.5397 1103.4365,693.9974 1088.5055,674.0347 C1074.8607,704.4761 1051.555,702.397 1033.8963,678.0343 C1019.9223,699.0413 999.3502,694.8358 990.744,672.6692 C975.4118,694.8379 954.3536,700.1427 937.9106,673.8809 C926.5016,695.9539 906.3456,694.8231 894.1947,674.6485 C882.1073,696.5921 864.0112,697.9735 847.9548,679.1503 C832.3059,696.5521 811.0663,695.3061 801.908,671.8376 C787.5177,700.1219 762.416,697.6728 747.3387,672.5393 C732.097,691.8407 714.3012,689.1787 701.6943,669.4575 C692.1574,690.0015 673.5285,695.5887 658.2257,675.6485 C642.3202,698.2475 622.4008,697.5446 608.6685,673.3471 C577.123,694.296 555.5518,691.6579 543.3333,652.3805 C545.7609,651.3854 546.6816,652.3805 546.9764,654.7144 C515.8554,642.5888 512.1866,620.5435 537.685,598.9791 C502.0912,562.9406 509.9352,536.3298 555,517.4138 C559.2247,514.3538 561.9406,516.6441 562.5838,521.0513" fill="#ECFDF5" style="stroke:#065F46;stroke-width:1.6667;"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" font-weight="bold" lengthAdjust="spacing" textLength="110.1042" x="834.1146" y="548.3057">Vertex AI</text></g><!--entity notebook--><g class="entity" data-qualified-name="local.notebook" data-source-line="7" id="ent0004"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="195.6755" x="263.8333" y="139.1471"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="110.2865" x="280.5" y="178.3724">Notebook</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="162.3421" x="280.5" y="205.8529">anc_gcp.ipynb</text></g><!--entity rag--><g class="entity" data-qualified-name="local.rag" data-source-line="8" id="ent0005"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="353.5742" x="109.8833" y="347.0305"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="145.1839" x="126.55" y="386.2557">RAG pipeline</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="320.2409" x="126.55" y="413.7362">(chunk + retrieve + prompt)</text></g><!--entity vs--><g class="entity" data-qualified-name="local.vs" data-source-line="9" id="ent0006"><path d="M174.1,571.5805 C174.1,554.9138 286.6749,554.9138 286.6749,554.9138 C286.6749,554.9138 399.2497,554.9138 399.2497,571.5805 L399.2497,641.5414 C399.2497,658.2081 286.6749,658.2081 286.6749,658.2081 C286.6749,658.2081 174.1,658.2081 174.1,641.5414 L174.1,571.5805" fill="#EEF2FF" style="stroke:#3730A3;stroke-width:0.8333;"/><path d="M174.1,571.5805 C174.1,588.2471 286.6749,588.2471 286.6749,588.2471 C286.6749,588.2471 399.2497,588.2471 399.2497,571.5805" fill="none" style="stroke:#3730A3;stroke-width:0.8333;"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="137.6986" x="190.7667" y="617.4724">Vector store</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="191.8164" x="190.7667" y="644.9529">(Chroma / FAISS)</text></g><!--entity emb--><g class="entity" data-qualified-name="vertex.emb" data-source-line="14" id="ent0009"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="284.3262" x="556.1667" y="562.4138"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="139.1569" x="572.8333" y="601.6391">Embeddings</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="250.9928" x="572.8333" y="629.1195">(VertexAIEmbeddings)</text></g><!--entity llm--><g class="entity" data-qualified-name="vertex.llm" data-source-line="15" id="ent0010"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="323.4961" x="898.25" y="562.4138"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="44.9805" x="914.9167" y="601.6391">LLM</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="290.1628" x="914.9167" y="629.1195">(Gemini via ChatVertexAI)</text></g><!--entity user--><g class="entity" data-qualified-name="user" data-source-line="4" id="ent0002"><ellipse cx="546.671" cy="341.6138" fill="#E0F2FE" rx="13.3333" ry="13.3333" style="stroke:#0369A1;stroke-width:0.8333;"/><path d="M546.671,354.9471 L546.671,399.9471 M525.0044,368.2805 L568.3377,368.2805 M546.671,399.9471 L525.0044,424.9471 M546.671,399.9471 L568.3377,424.9471" fill="none" style="stroke:#0369A1;stroke-width:0.8333;"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="50.6087" x="521.3667" y="450.0057">User</text></g><!--entity wiki--><g class="entity" data-qualified-name="wiki" data-source-line="12" id="ent0007"><path d="M647.2328,369.1941 C651.8723,358.4064 661.9077,359.4039 668.0417,367.5516 C672.6071,356.1607 682.5872,354.8565 690.3017,364.1651 C696.4202,354.7075 703.4925,353.8415 711.3569,362.0888 C718.5912,352.4537 727.699,351.1893 734.9399,362.0813 C742.663,352.7322 749.1959,354.5712 754.0839,364.8469 C761.4602,351.8593 768.939,351.988 777.6815,363.5327 C786.2264,354.7239 793.068,355.6947 798.3773,366.8815 C806.5752,356.8825 815.8633,358.5223 822.2356,369.0078 C836.8513,373.0929 838.3508,382.0437 828.7222,392.752 C839.0022,403.1744 836.837,415.035 821.4716,418.1306 C814.5508,429.9048 807.3876,429.0184 799.4762,419.1368 C795.052,432.1463 787.3159,432.1141 778.3512,423.5916 C773.1631,435.2593 762.347,434.7922 756.4712,424.2697 C751.6539,435.1195 740.5978,437.4586 732.5766,428.0481 C723.1309,435.3066 715.7647,435.7678 711.3494,422.7752 C705.3964,432.081 695.5151,430.6745 690.9087,421.3015 C684.2867,430.8189 673.0855,429.6163 667.9126,419.5961 C660.2824,429.3338 651.4043,430.4537 644.6764,418.6239 C628.7729,416.4895 626.4687,403.6076 635.7903,392.7949 C626.4961,380.6829 631.3532,369.1009 647.2328,369.1941" fill="#ECFDF5" style="stroke:#065F46;stroke-width:0.8333;"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="152.1908" x="655.5667" y="400.0057">Wikipedia API</text></g><g class="entity" data-qualified-name="GMN22" data-source-line="31" id="ent0023"><path d="M517.7333,172.1971 L517.7333,176.5471 L460.05,183.2138 L517.7333,189.8805 L517.7333,194.3814 A10,10 0 0 0 527.7333,204.3814 L882.2695,204.3814 A10,10 0 0 0 892.2695,194.3814 L892.2695,178.8638 L875.6028,162.1971 L527.7333,162.1971 A10,10 0 0 0 517.7333,172.1971" fill="#FFFBEB" style="stroke:#B45309;stroke-width:0.8333;"/><path d="M875.6028,162.1971 L875.6028,173.8638 A5,5 0 0 0 880.6028,178.8638 L892.2695,178.8638 L875.6028,162.1971" fill="#FFFBEB" style="stroke:#B45309;stroke-width:0.8333;"/><text fill="#92400E" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="339.5361" x="527.7333" y="191.4777">Auth: gcloud ADC\nConfig: .env</text></g><!--link user to notebook--><g class="link" data-entity-1="ent0002" data-entity-2="ent0004" data-link-type="dependency" data-source-line="18" id="lnk11"><path d="M538.2333,326.7138 C538.2333,279.3471 538.2333,223.2138 538.2333,223.2138 C538.2333,223.2138 510.7167,223.2138 470.2667,223.2138" fill="none" id="user-to-notebook" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="460.2667,223.2138,475.2667,229.8805,468.6,223.2138,475.2667,216.5471,460.2667,223.2138" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="248.278" x="289.9" y="258.5944">run cells / ask question</text></g><!--link notebook to user--><g class="link" data-entity-1="ent0004" data-entity-2="ent0002" data-link-type="dependency" data-source-line="28" id="lnk21"><path d="M460.0833,218.2138 C507.8667,218.2138 555.1,218.2138 555.1,218.2138 C555.1,218.2138 555.1,267.5971 555.1,316.7805" fill="none" id="notebook-to-user" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="555.1,326.7805,561.7667,311.7805,555.1,318.4471,548.4333,311.7805,555.1,326.7805" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="194.6191" x="556.7667" y="247.5944">answer + citations</text></g><!--link notebook to wiki--><g class="link" data-entity-1="ent0004" data-entity-2="ent0007" data-link-type="dependency" data-source-line="19" id="lnk12"><path d="M460.3,213.2138 C559.5333,213.2138 697.9667,213.2138 697.9667,213.2138 C697.9667,213.2138 697.9667,289.2471 697.9667,341.6805" fill="none" id="notebook-to-wiki" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="697.9667,351.6805,704.6333,336.6805,697.9667,343.3471,691.3,336.6805,697.9667,351.6805" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="114.2578" x="533.3667" y="235.8277">load pages</text></g><!--link wiki to notebook--><g class="link" data-entity-1="ent0007" data-entity-2="ent0004" data-link-type="dependency" data-source-line="20" id="lnk13"><path d="M765.3667,351.9305 C765.3667,298.1638 765.3667,208.2138 765.3667,208.2138 C765.3667,208.2138 589.4,208.2138 469.9,208.2138" fill="none" id="wiki-to-notebook" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="459.9,208.2138,474.9,214.8805,468.2333,208.2138,474.9,201.5471,459.9,208.2138" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="191.202" x="686.1667" y="230.8277">pages + metadata</text></g><!--link notebook to rag--><g class="link" data-entity-1="ent0004" data-entity-2="ent0005" data-link-type="dependency" data-source-line="21" id="lnk14"><path d="M394.2833,227.8971 C394.2833,262.9638 394.2833,301.5971 394.2833,336.6638" fill="none" id="notebook-to-rag" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="394.2833,346.6638,400.95,331.6638,394.2833,338.3305,387.6167,331.6638,394.2833,346.6638" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="264.6126" x="129.2833" y="309.8944">chunk + attach metadata</text></g><!--link rag to notebook--><g class="link" data-entity-1="ent0005" data-entity-2="ent0004" data-link-type="dependency" data-source-line="27" id="lnk20"><path d="M329.05,346.5805 C329.05,311.5138 329.05,272.8638 329.05,237.8138" fill="none" id="rag-to-notebook" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="329.05,227.8138,322.3833,242.8138,329.05,236.1471,335.7167,242.8138,329.05,227.8138" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="182.8548" x="145.7167" y="281.4777">validate + format</text></g><!--link rag to emb--><g class="link" data-entity-1="ent0005" data-entity-2="ent0009" data-link-type="dependency" data-source-line="22" id="lnk15"><path d="M424.9333,436.1471 C424.9333,495.2138 424.9333,591.5471 424.9333,591.5471 C424.9333,591.5471 479.5833,591.5471 546.0167,591.5471" fill="none" id="rag-to-emb" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="556.0167,591.5471,541.0167,584.8805,547.6833,591.5471,541.0167,598.2138,556.0167,591.5471" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="217.8621" x="426.6" y="573.6777">embed docs + query</text></g><!--link emb to rag--><g class="link" data-entity-1="ent0009" data-entity-2="ent0005" data-link-type="dependency" data-source-line="23" id="lnk16"><path d="M555.6333,621.5471 C483.9333,621.5471 412.0833,621.5471 412.0833,621.5471 C412.0833,621.5471 412.0833,513.1805 412.0833,446.1471" fill="none" id="emb-to-rag" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="412.0833,436.1471,405.4167,451.1471,412.0833,444.4805,418.75,451.1471,412.0833,436.1471" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="75.7064" x="413.75" y="623.2277">vectors</text></g><!--link rag to vs--><g class="link" data-entity-1="ent0005" data-entity-2="ent0006" data-link-type="dependency" data-source-line="24" id="lnk17"><path d="M286.6667,445.8138 C286.6667,480.3138 286.6667,508.1471 286.6667,544.4138" fill="none" id="rag-vs" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="286.6667,435.8138,280,450.8138,286.6667,444.1471,293.3333,450.8138,286.6667,435.8138" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="286.6667,554.4138,293.3333,539.4138,286.6667,546.0805,280,539.4138,286.6667,554.4138" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="274.0072" x="11.6667" y="489.3944">upsert + similarity_search</text></g><!--link rag to llm--><g class="link" data-entity-1="ent0005" data-entity-2="ent0010" data-link-type="dependency" data-source-line="25" id="lnk18"><path d="M450.6167,435.7138 C450.6167,461.2305 450.6167,488.2138 450.6167,488.2138 C450.6167,488.2138 1113.9167,488.2138 1113.9167,488.2138 C1113.9167,488.2138 1113.9167,518.3138 1113.9167,551.8305" fill="none" id="rag-to-llm" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="1113.9167,561.8305,1120.5833,546.8305,1113.9167,553.4971,1107.25,546.8305,1113.9167,561.8305" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="289.2733" x="794.4833" y="457.4944">prompt(question + chunks)</text><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="192.0589" x="794.4833" y="483.012">+ grounding rules</text></g><!--link llm to rag--><g class="link" data-entity-1="ent0010" data-entity-2="ent0005" data-link-type="dependency" data-source-line="26" id="lnk19"><path d="M1006.0833,562.0638 C1006.0833,541.4971 1006.0833,521.5471 1006.0833,521.5471 C1006.0833,521.5471 437.7667,521.5471 437.7667,521.5471 C437.7667,521.5471 437.7667,483.7471 437.7667,446.0471" fill="none" id="llm-to-rag" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="437.7667,436.0471,431.1,451.0471,437.7667,444.3805,444.4333,451.0471,437.7667,436.0471" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="122.5098" x="576.1" y="515.8277">answer text</text></g><?plantuml-src NLBBQXj14BpFLtHqaZ1MxY84baqY18fZ8k9S1A8rszeTD8_DFDOs8P2Fo1VcIz8pQqcHBsBLNLNTLJrlb9KwDGGxwOnnTjudeqLKKHDKTpNy_Vq7blKzl8K7yf6Ue5f1vMMd8icOFC6qJjwJZJCXK4RdOV8ja9y01aZy8OHrh3vPEuaQ6XfWQb1-sR3WMjdqD2j8NRe_1O1dMRGjJv_SkKXxvuvRYrRkMjdFLVzizuLWNthNZA_L4dhLarQMjdOgksIFSCE8w1KDn9-zTwQFur2FBTCRZBZ7mEm7Ali7_idikcCiyfwVgjLcCrA687u98RLB3Ko-goFFQXH2TRygxKUkdBhdk4RY-E-LmuzcJqsZR1jutaYeLfVYE9FC_fgrNdzc-9ACiWe67bzt64_ibporoOlc0y3jxVjpNB00don8qZgmCmn7-94eHEMiE6Co8JjXi7ROG8yj1L4ghxHAXrCr537dUAt1-JBcT0IC4MLtWUPkHh4zHb4s3OsJMOvNyiyYDouoGpbEABHtkJm4hgQU7KQc16MKHg_YyouGyliywtCKUTDoz-d9B3FANc6sjJVGUfTiJfp3qMmrKowJqOP7Zf7JZMVH_p8OK2isb1_NmNc3yJg4SeAp28zL4VC6GHGSUDLs4TpXygAh5Bi5jECpgZxKMrixUr3j0kPa1q6sALZn3m00?></g></svg>