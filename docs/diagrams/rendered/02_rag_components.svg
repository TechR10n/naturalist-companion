<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="641.6667px" preserveAspectRatio="none" style="width:3325px;height:641px;background:#FFFFFF;" version="1.1" viewBox="0 0 3325 641" width="3325px" zoomAndPan="magnify"><title>RAG Pipeline &#8212; Components (Ingest + Answer)</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="23.3333" font-weight="bold" lengthAdjust="spacing" textLength="567.5765" x="1367.2274" y="39.2253">RAG Pipeline &#8212; Components (Ingest + Answer)</text></g><!--cluster ingest--><g class="cluster" data-qualified-name="ingest" data-source-line="9" id="ent0004"><rect fill="#F8FAFC" height="188.3333" rx="10" ry="10" style="stroke:#334155;stroke-width:1.6667;" width="1382.6" x="289.6146" y="285.8138"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" font-weight="bold" lengthAdjust="spacing" textLength="424.1813" x="294.6146" y="311.7057">Ingestion (offline / ahead-of-time)</text></g><!--cluster answer--><g class="cluster" data-qualified-name="answer" data-source-line="16" id="ent0009"><rect fill="#F8FAFC" height="171.6667" rx="10" ry="10" style="stroke:#334155;stroke-width:1.6667;" width="1951.2167" x="1364.1479" y="74.1471"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" font-weight="bold" lengthAdjust="spacing" textLength="247.9964" x="1369.1479" y="100.0391">Answering (runtime)</text></g><!--entity loader--><g class="entity" data-qualified-name="ingest.loader" data-source-line="10" id="ent0005"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="219.3164" x="316.2813" y="351.6638"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="185.9831" x="332.9479" y="390.8891">WikipediaLoader</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="134.2692" x="332.9479" y="418.3695">(LangChain)</text></g><!--entity chunker--><g class="entity" data-qualified-name="ingest.chunker" data-source-line="11" id="ent0006"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="270.8822" x="635.5979" y="351.6638"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="95.7715" x="652.2646" y="390.8891">Chunker</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="237.5488" x="652.2646" y="418.3695">(~500-1,000 tokens)</text></g><!--entity docEmbed--><g class="entity" data-qualified-name="ingest.docEmbed" data-source-line="12" id="ent0007"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="284.3262" x="1006.4813" y="351.6638"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="139.1569" x="1023.1479" y="390.8891">Embeddings</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="250.9928" x="1023.1479" y="418.3695">(VertexAIEmbeddings)</text></g><!--entity store--><g class="entity" data-qualified-name="ingest.store" data-source-line="13" id="ent0008"><path d="M1420.3979,360.8305 C1420.3979,344.1638 1532.9728,344.1638 1532.9728,344.1638 C1532.9728,344.1638 1645.5477,344.1638 1645.5477,360.8305 L1645.5477,430.7914 C1645.5477,447.4581 1532.9728,447.4581 1532.9728,447.4581 C1532.9728,447.4581 1420.3979,447.4581 1420.3979,430.7914 L1420.3979,360.8305" fill="#EEF2FF" style="stroke:#3730A3;stroke-width:0.8333;"/><path d="M1420.3979,360.8305 C1420.3979,377.4971 1532.9728,377.4971 1532.9728,377.4971 C1532.9728,377.4971 1645.5477,377.4971 1645.5477,360.8305" fill="none" style="stroke:#3730A3;stroke-width:0.8333;"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="137.6986" x="1437.0646" y="406.7224">Vector store</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="191.8164" x="1437.0646" y="434.2029">(Chroma / FAISS)</text></g><!--entity qEmbed--><g class="entity" data-qualified-name="answer.qEmbed" data-source-line="17" id="ent0010"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="284.3262" x="1390.8146" y="131.6638"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="202.3438" x="1407.4813" y="170.8891">Query embedding</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="250.9928" x="1407.4813" y="198.3695">(VertexAIEmbeddings)</text></g><!--entity retriever--><g class="entity" data-qualified-name="answer.retriever" data-source-line="18" id="ent0011"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="258.9648" x="1775.1479" y="131.6638"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="100.3971" x="1791.8146" y="170.8891">Retriever</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="225.6315" x="1791.8146" y="198.3695">(similarity_search k)</text></g><!--entity prompt--><g class="entity" data-qualified-name="answer.prompt" data-source-line="19" id="ent0012"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="350.0765" x="2134.0979" y="131.6638"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="169.2464" x="2150.7646" y="170.8891">Prompt builder</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="316.7432" x="2150.7646" y="198.3695">(question + chunks + rules)</text></g><!--entity llm--><g class="entity" data-qualified-name="answer.llm" data-source-line="20" id="ent0013"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="304.0251" x="2584.1813" y="131.6638"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="44.9805" x="2600.8479" y="170.8891">LLM</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="270.6917" x="2600.8479" y="198.3695">(ChatVertexAI / Gemini)</text></g><!--entity validate--><g class="entity" data-qualified-name="answer.validate" data-source-line="21" id="ent0014"><rect fill="#F8FAFC" height="88.2943" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="300.4932" x="2988.1979" y="131.6638"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="267.1598" x="3004.8646" y="170.8891">Validation + formatting</text><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="224.6631" x="3004.8646" y="198.3695">(citations / schema)</text></g><!--entity user--><g class="entity" data-qualified-name="user" data-source-line="6" id="ent0002"><ellipse cx="1532.969" cy="519.5638" fill="#E0F2FE" rx="13.3333" ry="13.3333" style="stroke:#0369A1;stroke-width:0.8333;"/><path d="M1532.969,532.8971 L1532.969,577.8971 M1511.3023,546.2305 L1554.6356,546.2305 M1532.969,577.8971 L1511.3023,602.8971 M1532.969,577.8971 L1554.6356,602.8971" fill="none" style="stroke:#0369A1;stroke-width:0.8333;"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="50.6087" x="1507.6646" y="627.9557">User</text></g><!--entity wiki--><g class="entity" data-qualified-name="wiki" data-source-line="7" id="ent0003"><path d="M30.7641,373.8107 C35.4035,363.0231 45.439,364.0206 51.573,372.1683 C56.1383,360.7774 66.1185,359.4732 73.833,368.7818 C79.9515,359.3241 87.0238,358.4582 94.8882,366.7055 C102.1225,357.0704 111.2303,355.8059 118.4712,366.6979 C126.1942,357.3489 132.7272,359.1879 137.6152,369.4636 C144.9915,356.4759 152.4702,356.6047 161.2128,368.1494 C169.7576,359.3405 176.5992,360.3114 181.9085,371.4982 C190.1064,361.4992 199.3946,363.1389 205.7669,373.6244 C220.3825,377.7095 221.8821,386.6604 212.2534,397.3687 C222.5335,407.791 220.3683,419.6517 205.0029,422.7473 C198.0821,434.5214 190.9189,433.6351 183.0074,423.7535 C178.5833,436.763 170.8472,436.7308 161.8824,428.2082 C156.6944,439.876 145.8782,439.4089 140.0024,428.8863 C135.1851,439.7362 124.129,442.0753 116.1079,432.6648 C106.6622,439.9233 99.296,440.3845 94.8807,427.3918 C88.9276,436.6976 79.0464,435.2912 74.4399,425.9182 C67.818,435.4356 56.6168,434.2329 51.4439,424.2127 C43.8137,433.9505 34.9355,435.0704 28.2077,423.2406 C12.3042,421.1062 10,408.2242 19.3216,397.4115 C10.0274,385.2995 14.8844,373.7176 30.7641,373.8107" fill="#ECFDF5" style="stroke:#065F46;stroke-width:0.8333;"/><text fill="#0F172A" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="152.1908" x="39.0979" y="404.6224">Wikipedia API</text></g><!--link loader to wiki--><g class="link" data-entity-1="ent0005" data-entity-2="ent0003" data-link-type="dependency" data-source-line="24" id="lnk15"><path d="M315.5146,382.8971 C283.4146,382.8971 258.5146,382.8971 226.9646,382.8971" fill="none" id="loader-to-wiki" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="216.9646,382.8971,231.9646,389.5638,225.2979,382.8971,231.9646,376.2305,216.9646,382.8971" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="121.7692" x="142.9146" y="377.1777">fetch pages</text></g><!--link wiki to loader--><g class="link" data-entity-1="ent0003" data-entity-2="ent0005" data-link-type="dependency" data-source-line="25" id="lnk16"><path d="M216.9479,408.7138 C248.6313,408.7138 273.6979,408.7138 305.9313,408.7138" fill="none" id="wiki-to-loader" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="315.9313,408.7138,300.9313,402.0471,307.5979,408.7138,300.9313,415.3805,315.9313,408.7138" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="62.2282" x="203.0979" y="431.3277">pages</text></g><!--link loader to chunker--><g class="link" data-entity-1="ent0005" data-entity-2="ent0006" data-link-type="dependency" data-source-line="26" id="lnk17"><path d="M536.0813,395.8138 C567.6479,395.8138 592.4313,395.8138 625.3313,395.8138" fill="none" id="loader-to-chunker" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="635.3313,395.8138,620.3313,389.1471,626.9979,395.8138,620.3313,402.4805,635.3313,395.8138" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="122.0231" x="462.3813" y="418.4277">Document[]</text></g><!--link chunker to docEmbed--><g class="link" data-entity-1="ent0006" data-entity-2="ent0007" data-link-type="dependency" data-source-line="27" id="lnk18"><path d="M906.8313,395.8138 C938.9813,395.8138 963.3479,395.8138 995.7813,395.8138" fill="none" id="chunker-to-docEmbed" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="1005.7813,395.8138,990.7813,389.1471,997.4479,395.8138,990.7813,402.4805,1005.7813,395.8138" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="204.1195" x="751.3146" y="418.4277">chunks + metadata</text></g><!--link docEmbed to store--><g class="link" data-entity-1="ent0007" data-entity-2="ent0008" data-link-type="dependency" data-source-line="28" id="lnk19"><path d="M1291.2146,395.8138 C1333.7313,395.8138 1369.7146,395.8138 1410.0479,395.8138" fill="none" id="docEmbed-to-store" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="1420.0479,395.8138,1405.0479,389.1471,1411.7146,395.8138,1405.0479,402.4805,1420.0479,395.8138" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="204.6802" x="1150.6313" y="418.4277">vectors + metadata</text></g><!--link user to retriever--><g class="link" data-entity-1="ent0002" data-entity-2="ent0011" data-link-type="dependency" data-source-line="30" id="lnk20"><path d="M1558.9313,547.8971 C1652.7313,547.8971 1968.6979,547.8971 1968.6979,547.8971 C1968.6979,547.8971 1968.6979,329.6471 1968.6979,230.6971" fill="none" id="user-to-retriever" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="1968.6979,220.6971,1962.0313,235.6971,1968.6979,229.0305,1975.3646,235.6971,1968.6979,220.6971" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="91.3216" x="1835.7479" y="570.5111">question</text></g><!--link retriever to qEmbed--><g class="link" data-entity-1="ent0011" data-entity-2="ent0010" data-link-type="dependency" data-source-line="31" id="lnk21"><path d="M1774.6313,190.5305 C1742.6146,190.5305 1718.1479,190.5305 1685.5646,190.5305" fill="none" id="retriever-to-qEmbed" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="1675.5646,190.5305,1690.5646,197.1971,1683.8979,190.5305,1690.5646,183.8638,1675.5646,190.5305" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="247.2306" x="1476.7646" y="213.1444">embed_query(question)</text></g><!--link qEmbed to retriever--><g class="link" data-entity-1="ent0010" data-entity-2="ent0011" data-link-type="dependency" data-source-line="32" id="lnk22"><path d="M1675.5979,161.0971 C1708.1479,161.0971 1732.5646,161.0971 1764.5646,161.0971" fill="none" id="qEmbed-to-retriever" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="1774.5646,161.0971,1759.5646,154.4305,1766.2313,161.0971,1759.5646,167.7638,1774.5646,161.0971" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="130.8569" x="1593.4146" y="183.7111">query vector</text></g><!--link retriever to store--><g class="link" data-entity-1="ent0011" data-entity-2="ent0008" data-link-type="dependency" data-source-line="33" id="lnk23"><path d="M1840.3646,220.3138 C1840.3646,279.9971 1840.3646,378.5971 1840.3646,378.5971 C1840.3646,378.5971 1743.7813,378.5971 1656.1313,378.5971" fill="none" id="retriever-to-store" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="1646.1313,378.5971,1661.1313,385.2638,1654.4646,378.5971,1661.1313,371.9305,1646.1313,378.5971" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="175.9041" x="1824.0479" y="401.2111">similarity_search</text></g><!--link store to retriever--><g class="link" data-entity-1="ent0008" data-entity-2="ent0011" data-link-type="dependency" data-source-line="34" id="lnk24"><path d="M1646.2146,413.0305 C1755.7813,413.0305 1905.3646,413.0305 1905.3646,413.0305 C1905.3646,413.0305 1905.3646,299.1471 1905.3646,230.4305" fill="none" id="store-to-retriever" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="1905.3646,220.4305,1898.6979,235.4305,1905.3646,228.7638,1912.0313,235.4305,1905.3646,220.4305" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="142.251" x="1873.7646" y="435.6444">top-k chunks</text><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="270.3573" x="1873.7646" y="461.162">(title, source URL, pageid)</text></g><!--link retriever to prompt--><g class="link" data-entity-1="ent0011" data-entity-2="ent0012" data-link-type="dependency" data-source-line="35" id="lnk25"><path d="M2034.8479,175.8138 C2066.2479,175.8138 2090.3313,175.8138 2123.4479,175.8138" fill="none" id="retriever-to-prompt" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="2133.4479,175.8138,2118.4479,169.1471,2125.1146,175.8138,2118.4479,182.4805,2133.4479,175.8138" style="stroke:#334155;stroke-width:1.6667;"/></g><!--link prompt to llm--><g class="link" data-entity-1="ent0012" data-entity-2="ent0013" data-link-type="dependency" data-source-line="36" id="lnk26"><path d="M2484.6813,175.8138 C2517.5813,175.8138 2541.7313,175.8138 2573.8479,175.8138" fill="none" id="prompt-to-llm" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="2583.8479,175.8138,2568.8479,169.1471,2575.5146,175.8138,2568.8479,182.4805,2583.8479,175.8138" style="stroke:#334155;stroke-width:1.6667;"/></g><!--link llm to validate--><g class="link" data-entity-1="ent0013" data-entity-2="ent0014" data-link-type="dependency" data-source-line="37" id="lnk27"><path d="M2888.8479,175.8138 C2921.2979,175.8138 2945.5313,175.8138 2977.8979,175.8138" fill="none" id="llm-to-validate" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="2987.8979,175.8138,2972.8979,169.1471,2979.5646,175.8138,2972.8979,182.4805,2987.8979,175.8138" style="stroke:#334155;stroke-width:1.6667;"/></g><!--link validate to user--><g class="link" data-entity-1="ent0014" data-entity-2="ent0002" data-link-type="dependency" data-source-line="38" id="lnk28"><path d="M3138.6979,220.1805 C3138.6979,327.1305 3138.6979,590.3805 3138.6979,590.3805 C3138.6979,590.3805 1775.3813,590.3805 1568.8479,590.3805" fill="none" id="validate-to-user" style="stroke:#334155;stroke-width:1.6667;"/><polygon fill="#334155" points="1558.8479,590.3805,1573.8479,597.0471,1567.1813,590.3805,1573.8479,583.7138,1558.8479,590.3805" style="stroke:#334155;stroke-width:1.6667;"/><text fill="#334155" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="194.6191" x="2338.8813" y="612.9944">answer + citations</text></g><?plantuml-src VLHDRnCn4BtxLmmv9Me2uS0b1wGeG1KfI2LLom5GvNfdirRMziRsjbG8r1_1B-INC3jUvmk9msQjyNlpyUPjNcYhwhP0k5FE66TVDgsfHTInHbZFB-5ADrXhY_3d-JSid6cSHHi339TsWo721SnjU4G_4gB6Ca9quFMcYb1eZofgPuMGAZeFWvk0VW0oG4i7eMhN5Z3uhBTKeT0IvbTBldsaY12DL5kvGHYaEfG7XguikPLN82kKnSILawWDZfYcKpy_183ARHwbNpbPeFzgXojfDujAQfjeDSTFIOkgjLi6_tepdKvUZwVJAGssHHiIIIN0AUkzkSUYe3O24M_HH_m-Nnw2YLaunI6Y5ZBAUnben5jaWGBz874NbNT6qfGVvilhwyJZE_7pI9SaEsM6eM_jGGV9yNCTFhNedm1pD__fS9VxEsAlCNgD3on9q4RNqkluT1TGUbN1DX5z1frohsYO9i9zg-kqW5tRx_CYwHZeuDiQ-_eDuqzph5OVMHSPSzUapYKQRNM_nTgSCcvbhKdWLAPqtiWOqznAHuu7IX5KXKQc50-9mI8dKy1ayfRT23CeCTAa3IaV18Uwknusw-D7hDuWTFNEgTPGIr--YHpi0Da7XDYBO33ApXHYVzaXUVC4Us2JdE14zo4nQAyz0RE-uX3i8BjSZqrmj-iCiT_5IEmE5S-IaMzIxRE4kR5_327IpNcgw9h9jf-Mzi1_CMC8hlKAuMQz6hECkXYTrUaDaLv9TzesFNpUhoqVECh2pFAtG4RBInT_0G00?></g></svg>