<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="ACTIVITY" height="2531.6667px" preserveAspectRatio="none" style="width:730px;height:2531px;background:#FFFFFF;" version="1.1" viewBox="0 0 730 2531" width="730px" zoomAndPan="magnify"><title>Roadside Geology v0 &#8212; Agentic Workflow (LangGraph)</title><defs/><g><g class="title" data-source-line="2"><text fill="#000000" font-family="sans-serif" font-size="23.3333" font-weight="bold" lengthAdjust="spacing" textLength="658.7565" x="33.3333" y="55.8919">Roadside Geology v0 &#8212; Agentic Workflow (LangGraph)</text></g><ellipse cx="350.6999" cy="95.8138" fill="#222222" rx="16.6667" ry="16.6667" style="stroke:#222222;stroke-width:1.6667;"/><rect fill="none" height="365.2539" rx="10" ry="10" style="stroke:#000000;stroke-width:2.5;" width="350.3581" x="175.5208" y="129.1471"/><path d="M316.7839,129.1471 L316.7839,144.9609 L300.1172,161.6276 L175.5208,161.6276" fill="none" style="stroke:#000000;stroke-width:2.5;"/><text fill="#000000" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="124.5964" x="180.5208" y="153.3724">Route prep</text><rect fill="#F8FAFC" height="80.4427" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="221.888" x="239.7559" y="189.9609"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="120.9863" x="256.4225" y="225.9635">ingest_route</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="188.5547" x="256.4225" y="249.5182">(GPX / JSON points)</text><rect fill="#F8FAFC" height="56.888" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="317.0247" x="192.1875" y="303.737"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="283.6914" x="208.8542" y="339.7396">compute cumulative distance</text><rect fill="#F8FAFC" height="80.4427" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="205.7064" x="247.8467" y="393.9583"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="140.166" x="264.5133" y="429.9609">sample_points</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="172.373" x="264.5133" y="453.5156">(sample_every_m)</text><rect fill="none" height="479.0299" rx="10" ry="10" style="stroke:#000000;stroke-width:2.5;" width="417.2331" x="142.0833" y="511.0677"/><path d="M346.556,511.0677 L346.556,526.8815 L329.8893,543.5482 L142.0833,543.5482" fill="none" style="stroke:#000000;stroke-width:2.5;"/><text fill="#000000" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="187.806" x="147.0833" y="535.293">Discovery (tools)</text><rect fill="#F8FAFC" height="80.4427" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="247.8548" x="226.7725" y="571.8815"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="99.1211" x="243.4391" y="607.8841">geosearch</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="214.5215" x="243.4391" y="631.4388">(Wikipedia GeoSearch)</text><rect fill="#F8FAFC" height="80.4427" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="288.1673" x="206.6162" y="685.6576"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="105.8789" x="223.2829" y="721.6602">fetch_page</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="254.834" x="223.2829" y="745.2148">(extract + url + metadata)</text><rect fill="#F8FAFC" height="56.888" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="383.8997" x="158.75" y="799.4336"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="350.5664" x="175.4167" y="835.4362">filter candidates (geology relevance)</text><rect fill="#F8FAFC" height="80.4427" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="355.3743" x="173.0127" y="889.6549"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="115.0586" x="189.6794" y="925.6576">select stops</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="322.041" x="189.6794" y="949.2122">(dedupe + spacing + max_stops)</text><rect fill="none" height="318.1445" rx="10" ry="10" style="stroke:#000000;stroke-width:2.5;" width="332.7507" x="184.3245" y="1006.7643"/><path d="M264.1895,1006.7643 L264.1895,1022.5781 L247.5228,1039.2448 L184.3245,1039.2448" fill="none" style="stroke:#000000;stroke-width:2.5;"/><text fill="#000000" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="63.1982" x="189.3245" y="1030.9896">Index</text><rect fill="#F8FAFC" height="56.888" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="242.3177" x="229.541" y="1067.5781"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="208.9844" x="246.2077" y="1103.5807">chunk selected pages</text><rect fill="#F8FAFC" height="56.888" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="175.1595" x="263.1201" y="1157.7995"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="141.8262" x="279.7868" y="1193.8021">embed chunks</text><rect fill="#F8FAFC" height="56.888" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="299.4173" x="200.9912" y="1248.0208"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="266.084" x="217.6579" y="1284.0234">build / update vector index</text><rect fill="none" height="923.8607" rx="10" ry="10" style="stroke:#000000;stroke-width:2.5;" width="445.2799" x="143.0599" y="1341.5755"/><path d="M315.791,1341.5755 L315.791,1357.3893 L299.1243,1374.056 L143.0599,1374.056" fill="none" style="stroke:#000000;stroke-width:2.5;"/><text fill="#000000" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="156.0645" x="148.0599" y="1365.8008">Per-stop loop</text><rect fill="#F8FAFC" height="80.4427" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="257.1224" x="222.1387" y="1475.7227"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="73.4082" x="238.8053" y="1511.7253">retrieve</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="223.7891" x="238.8053" y="1535.2799">(vector store similarity)</text><rect fill="#F8FAFC" height="80.4427" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="240.7943" x="230.3027" y="1589.4987"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="152.6074" x="246.9694" y="1625.5013">write_stop_card</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="207.4609" x="246.9694" y="1649.056">(LLM + JSON schema)</text><rect fill="#F8FAFC" height="80.4427" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="381.9466" x="159.7266" y="1703.2747"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="179.8242" x="176.3932" y="1739.2773">validate_stop_card</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="348.6133" x="176.3932" y="1762.832">(schema + wikipedia-only citations)</text><rect fill="#F8FAFC" height="80.4427" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="169.0755" x="266.1621" y="1910.7161"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="97.8516" x="282.8288" y="1946.7188">retry once</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="135.7422" x="282.8288" y="1970.2734">(stricter rules)</text><rect fill="#F8FAFC" height="56.888" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="213.1576" x="244.1211" y="2041.8815"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="179.8242" x="260.7878" y="2077.8841">validate_stop_card</text><polygon fill="#F8FAFC" points="325.957,1829.9202,375.4427,1829.9202,395.4427,1849.9202,375.4427,1869.9202,325.957,1869.9202,305.957,1849.9202,325.957,1829.9202" style="stroke:#334155;stroke-width:0.8333;"/><text fill="#334155" font-family="sans-serif" font-size="18.3333" lengthAdjust="spacing" textLength="22.6392" x="357.3665" y="1887.6449">no</text><text fill="#0F172A" font-family="sans-serif" font-size="18.3333" lengthAdjust="spacing" textLength="49.4857" x="325.957" y="1856.849">valid?</text><text fill="#334155" font-family="sans-serif" font-size="18.3333" lengthAdjust="spacing" textLength="29.1382" x="395.4427" y="1846.0531">yes</text><polygon fill="#F8FAFC" points="350.6999,2132.1029,370.6999,2152.1029,350.6999,2172.1029,330.6999,2152.1029,350.6999,2132.1029" style="stroke:#334155;stroke-width:0.8333;"/><polygon fill="#F8FAFC" points="350.6999,1402.3893,370.6999,1422.3893,350.6999,1442.3893,330.6999,1422.3893,350.6999,1402.3893" style="stroke:#334155;stroke-width:0.8333;"/><polygon fill="#F8FAFC" points="304.5846,2205.4362,396.8152,2205.4362,416.8152,2225.4362,396.8152,2245.4362,304.5846,2245.4362,284.5846,2225.4362,304.5846,2205.4362" style="stroke:#334155;stroke-width:0.8333;"/><text fill="#0F172A" font-family="sans-serif" font-size="18.3333" lengthAdjust="spacing" textLength="92.2306" x="304.5846" y="2232.3649">next stop?</text><text fill="#334155" font-family="sans-serif" font-size="18.3333" lengthAdjust="spacing" textLength="29.1382" x="416.8152" y="2221.569">yes</text><rect fill="none" height="161.2565" rx="10" ry="10" style="stroke:#000000;stroke-width:2.5;" width="301.9108" x="199.7445" y="2282.1029"/><path d="M307.5342,2282.1029 L307.5342,2297.9167 L290.8675,2314.5833 L199.7445,2314.5833" fill="none" style="stroke:#000000;stroke-width:2.5;"/><text fill="#000000" font-family="sans-serif" font-size="23.3333" lengthAdjust="spacing" textLength="91.123" x="204.7445" y="2306.3281">Outputs</text><rect fill="#F8FAFC" height="80.4427" rx="10" ry="10" style="stroke:#334155;stroke-width:0.8333;" width="268.5775" x="216.4111" y="2342.9167"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="148.5059" x="233.0778" y="2378.9193">render_outputs</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="235.2441" x="233.0778" y="2402.474">(guide.json + guide.md)</text><ellipse cx="350.6999" cy="2495.026" fill="none" rx="18.3333" ry="18.3333" style="stroke:#222222;stroke-width:1.6667;"/><ellipse cx="350.6999" cy="2495.026" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="270.4036" y2="303.737"/><polygon fill="#334155" points="344.0332,287.0703,350.6999,303.737,357.3665,287.0703,350.6999,293.737" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="360.625" y2="393.9583"/><polygon fill="#334155" points="344.0332,377.2917,350.6999,393.9583,357.3665,377.2917,350.6999,383.9583" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="112.4805" y2="189.9609"/><polygon fill="#334155" points="344.0332,173.2943,350.6999,189.9609,357.3665,173.2943,350.6999,179.9609" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="652.3242" y2="685.6576"/><polygon fill="#334155" points="344.0332,668.9909,350.6999,685.6576,357.3665,668.9909,350.6999,675.6576" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="766.1003" y2="799.4336"/><polygon fill="#334155" points="344.0332,782.7669,350.6999,799.4336,357.3665,782.7669,350.6999,789.4336" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="856.3216" y2="889.6549"/><polygon fill="#334155" points="344.0332,872.9883,350.6999,889.6549,357.3665,872.9883,350.6999,879.6549" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="474.401" y2="571.8815"/><polygon fill="#334155" points="344.0332,555.2148,350.6999,571.8815,357.3665,555.2148,350.6999,561.8815" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="1124.4661" y2="1157.7995"/><polygon fill="#334155" points="344.0332,1141.1328,350.6999,1157.7995,357.3665,1141.1328,350.6999,1147.7995" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="1214.6875" y2="1248.0208"/><polygon fill="#334155" points="344.0332,1231.3542,350.6999,1248.0208,357.3665,1231.3542,350.6999,1238.0208" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="970.0977" y2="1067.5781"/><polygon fill="#334155" points="344.0332,1050.9115,350.6999,1067.5781,357.3665,1050.9115,350.6999,1057.5781" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="1556.1654" y2="1589.4987"/><polygon fill="#334155" points="344.0332,1572.832,350.6999,1589.4987,357.3665,1572.832,350.6999,1579.4987" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="1669.9414" y2="1703.2747"/><polygon fill="#334155" points="344.0332,1686.6081,350.6999,1703.2747,357.3665,1686.6081,350.6999,1693.2747" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="1991.1589" y2="2041.8815"/><polygon fill="#334155" points="344.0332,2025.2148,350.6999,2041.8815,357.3665,2025.2148,350.6999,2031.8815" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="1869.9202" y2="1910.7161"/><polygon fill="#334155" points="344.0332,1894.0495,350.6999,1910.7161,357.3665,1894.0495,350.6999,1900.7161" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="395.4427" x2="473.9453" y1="1849.9202" y2="1849.9202"/><polygon fill="#334155" points="467.2786,1991.8815,473.9453,2008.5482,480.612,1991.8815,473.9453,1998.5482" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="473.9453" x2="473.9453" y1="1849.9202" y2="2152.1029"/><line style="stroke:#334155;stroke-width:1.6667;" x1="473.9453" x2="370.6999" y1="2152.1029" y2="2152.1029"/><polygon fill="#334155" points="387.3665,2145.4362,370.6999,2152.1029,387.3665,2158.7695,380.6999,2152.1029" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="2098.7695" y2="2132.1029"/><polygon fill="#334155" points="344.0332,2115.4362,350.6999,2132.1029,357.3665,2115.4362,350.6999,2122.1029" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="1783.7174" y2="1829.9202"/><polygon fill="#334155" points="344.0332,1813.2536,350.6999,1829.9202,357.3665,1813.2536,350.6999,1819.9202" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="1442.3893" y2="1475.7227"/><polygon fill="#334155" points="344.0332,1459.056,350.6999,1475.7227,357.3665,1459.056,350.6999,1465.7227" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="416.8152" x2="561.6732" y1="2225.4362" y2="2225.4362"/><polygon fill="#334155" points="555.0065,1817.0508,561.6732,1800.3841,568.3398,1817.0508,561.6732,1810.3841" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="561.6732" x2="561.6732" y1="1422.3893" y2="2225.4362"/><line style="stroke:#334155;stroke-width:1.6667;" x1="561.6732" x2="370.6999" y1="1422.3893" y2="1422.3893"/><polygon fill="#334155" points="387.3665,1415.7227,370.6999,1422.3893,387.3665,1429.056,380.6999,1422.3893" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="2172.1029" y2="2205.4362"/><polygon fill="#334155" points="344.0332,2188.7695,350.6999,2205.4362,357.3665,2188.7695,350.6999,2195.4362" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="1304.9089" y2="1402.3893"/><polygon fill="#334155" points="344.0332,1385.7227,350.6999,1402.3893,357.3665,1385.7227,350.6999,1392.3893" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="2245.4362" y2="2342.9167"/><polygon fill="#334155" points="344.0332,2326.25,350.6999,2342.9167,357.3665,2326.25,350.6999,2332.9167" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="350.6999" x2="350.6999" y1="2423.3594" y2="2476.6927"/><polygon fill="#334155" points="344.0332,2460.026,350.6999,2476.6927,357.3665,2460.026,350.6999,2466.6927" style="stroke:#334155;stroke-width:1.6667;"/><?plantuml-src RLF1ZjGm3BttAyoUEbhjmXaE20bf11hOrUvXEI1LsSJJcacJA74wKo4aFe8lv4jmqivA2rogsdv-VlPhNv3JDXk4JljnzEuwvD4sJ6mHxhmoYQIsHMzzFyFq2dx__0NlUdHC6XvyFEojFqAxKwxVHXM6JTCaLf6R9iYJcBo3YpkV6I5431VmlG5uJQx7n5qi-Q-ktTv-WPVmyVxcCmHFZjFcJK69e50QTHwpLKmJWY5XTnfhFQanMEoM5g5POvmmpjqe73-UgNXFIVjIWvQzjscpYkdH9rHH3qBnG0SAQ4YLbUzhTj6oHzP35rHVzEA9ez8Cbv2ZbUU8h8nYjKB9CaRGoXcIB2Pe-_L-4IrEHV-2J18AJM8VYdw39WSKlXIKbXCLPdNgQlcVRJuuWwTr0praTu253GqKbQaEmF5HubfU4e-Ph95Rvr2KmIGDFW8Lhhy7t6AyAgF1Uh_w9WQYOdaHfeWSIKujkbSM0KU4H2DP5OddkgCWZn9WtQBJAXffsEq-oMxLxwG77DKPEYbRJ_OClK2auNWsvyexEuCcLaLgMhjf3sqbUBi17j11EsFQr1BQXD0wlqIh-XcyE546o2QwM1QpnJFRVzKi9HHZzq_dWED0jh3BLr6jbF6Krk7FJtgJMJxejBeMXGTZvvUawEYp_6lNtv90Bs49HhCONtYRFm00?></g></svg>