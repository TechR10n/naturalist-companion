<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="ACTIVITY" height="1631.6667px" preserveAspectRatio="none" style="width:1558px;height:1631px;background:#FFFFFF;" version="1.1" viewBox="0 0 1558 1631" width="1558.3333px" zoomAndPan="magnify"><title>ANC &#8212; Databricks Notebook Current State (Exported Run)</title><defs/><g><g class="title" data-source-line="17"><text fill="#000000" font-family="sans-serif" font-size="23.3333" font-weight="bold" lengthAdjust="spacing" textLength="696.9694" x="428.2837" y="55.8919">ANC &#8212; Databricks Notebook Current State (Exported Run)</text></g><ellipse cx="300.4688" cy="95.8138" fill="#222222" rx="16.6667" ry="16.6667" style="stroke:#222222;stroke-width:1.6667;"/><rect fill="#F8FAFC" height="56.888" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="564.2708" x="18.3333" y="145.8138"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="530.9375" x="35" y="181.8164">User runs `anc_dbrx.ipynb` and asks a route question</text><rect fill="#F8FAFC" height="80.4427" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="417.4251" x="91.7562" y="236.0352"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="185.752" x="108.4229" y="272.0378">[Notebook] Stage 1</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="384.0918" x="108.4229" y="295.5924">load Wikipedia pages + image previews</text><rect fill="#F8FAFC" height="80.4427" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="282.1224" x="159.4076" y="349.8112"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="143.457" x="176.0742" y="385.8138">[Wikipedia API]</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="248.7891" x="176.0742" y="409.3685">return docs + thumbnails</text><rect fill="#F8FAFC" height="80.4427" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="444.7201" x="78.1087" y="463.5872"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="185.752" x="94.7754" y="499.5898">[Notebook] Stage 2</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="411.3867" x="94.7754" y="523.1445">chunk docs + prepare embedding batches</text><rect fill="#F8FAFC" height="80.4427" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="341.9759" x="129.4808" y="577.3633"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="215.1074" x="146.1475" y="613.3659">[Embedding endpoint]</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="308.6426" x="146.1475" y="636.9206">`bge-large-en` returns vectors</text><rect fill="#F8FAFC" height="80.4427" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="437.7767" x="81.5804" y="691.1393"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="404.4434" x="98.2471" y="727.1419">[Notebook] build + save local FAISS index</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="173.7598" x="98.2471" y="750.6966">(driver filesystem)</text><rect fill="#F8FAFC" height="80.4427" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="415.2083" x="92.8646" y="804.9154"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="185.752" x="109.5313" y="840.918">[Notebook] Stage 3</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="381.875" x="109.5313" y="864.4727">retrieve top chunks + compose prompt</text><rect fill="#F8FAFC" height="80.4427" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="427.0443" x="86.9466" y="918.6914"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="144.5801" x="103.6133" y="954.694">[LLM endpoint]</text><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="393.7109" x="103.6133" y="978.2487">`llama-3.1-8b-instruct` returns answer</text><rect fill="#F8FAFC" height="56.888" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="457.5618" x="71.6878" y="1113.2633"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="424.2285" x="88.3545" y="1149.266">[StateGraph] run/eval shared workflow path</text><rect fill="#F8FAFC" height="56.888" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="379.9642" x="110.4867" y="1228.4847"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="346.6309" x="127.1533" y="1264.4873">[Artifacts] write `out/stategraph/*`</text><polygon fill="#F8FAFC" points="188.2576,1032.4674,412.6799,1032.4674,432.6799,1052.4674,412.6799,1072.4674,188.2576,1072.4674,168.2576,1052.4674,188.2576,1032.4674" style="stroke:#334155;stroke-width:0.8333;"/><text fill="#334155" font-family="sans-serif" font-size="18.3333" lengthAdjust="spacing" textLength="29.1382" x="307.1354" y="1090.1921">yes</text><text fill="#0F172A" font-family="sans-serif" font-size="18.3333" lengthAdjust="spacing" textLength="224.4222" x="188.2576" y="1059.3962">Run optional StateGraph?</text><polygon fill="#F8FAFC" points="300.4688,1318.7061,320.4688,1338.7061,300.4688,1358.7061,280.4688,1338.7061,300.4688,1318.7061" style="stroke:#334155;stroke-width:0.8333;"/><rect fill="#F8FAFC" height="56.888" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="368.1771" x="116.3802" y="1392.0394"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="334.8438" x="133.0469" y="1428.042">[MLflow] LangChain autolog traces</text><rect fill="#F8FAFC" height="56.888" rx="20.8333" ry="20.8333" style="stroke:#334155;stroke-width:0.8333;" width="412.7474" x="94.0951" y="1482.2607"/><text fill="#0F172A" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="379.4141" x="110.7617" y="1518.2633">[Notebook] return response + citations</text><path d="M352.1354,1569.7233 L352.1354,1584.1488 L318.8021,1590.8154 L352.1354,1597.4821 L352.1354,1611.9076 A0,0 0 0 0 352.1354,1611.9076 L1538.5368,1611.9076 A0,0 0 0 0 1538.5368,1611.9076 L1538.5368,1586.39 L1521.8701,1569.7233 L352.1354,1569.7233 A0,0 0 0 0 352.1354,1569.7233" fill="#FFFBEB" style="stroke:#B45309;stroke-width:0.8333;"/><path d="M1521.8701,1569.7233 L1521.8701,1586.39 L1538.5368,1586.39 L1521.8701,1569.7233" fill="#FFFBEB" style="stroke:#B45309;stroke-width:0.8333;"/><text fill="#92400E" font-family="sans-serif" font-size="21.6667" lengthAdjust="spacing" textLength="1151.4014" x="362.1354" y="1599.0039">Current notebook StateGraph retrieval path\nis deterministic corpus based.\nFAISS index is local/ephemeral.</text><ellipse cx="300.4688" cy="1590.8154" fill="none" rx="18.3333" ry="18.3333" style="stroke:#222222;stroke-width:1.6667;"/><ellipse cx="300.4688" cy="1590.8154" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="112.4805" y2="145.8138"/><polygon fill="#334155" points="293.8021,129.1471,300.4688,145.8138,307.1354,129.1471,300.4688,135.8138" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="202.7018" y2="236.0352"/><polygon fill="#334155" points="293.8021,219.3685,300.4688,236.0352,307.1354,219.3685,300.4688,226.0352" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="316.4779" y2="349.8112"/><polygon fill="#334155" points="293.8021,333.1445,300.4688,349.8112,307.1354,333.1445,300.4688,339.8112" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="430.2539" y2="463.5872"/><polygon fill="#334155" points="293.8021,446.9206,300.4688,463.5872,307.1354,446.9206,300.4688,453.5872" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="544.0299" y2="577.3633"/><polygon fill="#334155" points="293.8021,560.6966,300.4688,577.3633,307.1354,560.6966,300.4688,567.3633" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="657.806" y2="691.1393"/><polygon fill="#334155" points="293.8021,674.4727,300.4688,691.1393,307.1354,674.4727,300.4688,681.1393" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="771.582" y2="804.9154"/><polygon fill="#334155" points="293.8021,788.2487,300.4688,804.9154,307.1354,788.2487,300.4688,794.9154" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="885.3581" y2="918.6914"/><polygon fill="#334155" points="293.8021,902.0247,300.4688,918.6914,307.1354,902.0247,300.4688,908.6914" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="1170.1514" y2="1228.4847"/><polygon fill="#334155" points="293.8021,1211.818,300.4688,1228.4847,307.1354,1211.818,300.4688,1218.4847" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="1072.4674" y2="1113.2633"/><polygon fill="#334155" points="293.8021,1096.5967,300.4688,1113.2633,307.1354,1096.5967,300.4688,1103.2633" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="432.6799" x2="545.9163" y1="1052.4674" y2="1052.4674"/><polygon fill="#334155" points="539.2497,1182.6514,545.9163,1199.318,552.583,1182.6514,545.9163,1189.318" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="545.9163" x2="545.9163" y1="1052.4674" y2="1338.7061"/><line style="stroke:#334155;stroke-width:1.6667;" x1="545.9163" x2="320.4688" y1="1338.7061" y2="1338.7061"/><polygon fill="#334155" points="337.1354,1332.0394,320.4688,1338.7061,337.1354,1345.3727,330.4688,1338.7061" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="1285.3727" y2="1318.7061"/><polygon fill="#334155" points="293.8021,1302.0394,300.4688,1318.7061,307.1354,1302.0394,300.4688,1308.7061" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="999.1341" y2="1032.4674"/><polygon fill="#334155" points="293.8021,1015.8008,300.4688,1032.4674,307.1354,1015.8008,300.4688,1022.4674" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="1358.7061" y2="1392.0394"/><polygon fill="#334155" points="293.8021,1375.3727,300.4688,1392.0394,307.1354,1375.3727,300.4688,1382.0394" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="1448.9274" y2="1482.2607"/><polygon fill="#334155" points="293.8021,1465.5941,300.4688,1482.2607,307.1354,1465.5941,300.4688,1472.2607" style="stroke:#334155;stroke-width:1.6667;"/><line style="stroke:#334155;stroke-width:1.6667;" x1="300.4688" x2="300.4688" y1="1539.1488" y2="1572.4821"/><polygon fill="#334155" points="293.8021,1555.8154,300.4688,1572.4821,307.1354,1555.8154,300.4688,1562.4821" style="stroke:#334155;stroke-width:1.6667;"/><?plantuml-src TLJRRkD637tNLn3eIz8YYHqdxMxoK3XkN2oGNHHDYpwiZNgaeIN28uxAeUm4HO5-HB-mNrAEwcoyGTOFXi3BuU7XaTA6k7FYMaYDyt57NCFQXOH5-fGfNRMf9VRiPp54WQ_cm--WmkFQzK5_mGUT1ggvHLO8kDR3cevW_Ete838LYRizv6HoCRwyV9cSHzOl5N1KX3yBW9jNwDtStkHC58-oZzvSN4v6Rorw0Fhs_68qkYt-Ee1rbTAMzF4Bq6_cq_di9VIUssVGe_duk_EfGIjfG9X-cC6_V_y3FpXrfL2rIV315YXZtC2i5yc2tQkpbOvk7xeeYXv-xlcuA98wqUBgruG2qdE2bUFgTr_AmobrZrokmB47bmpHWN4rY3zwJ4gHhukhZqzJbXc-HXWlE4JduJVQK8UU77GMJl0DK9lpdU2MS9ToxtFDzATtomKBQYyCFbQvNfk-BTbHIA_DELzmrVIyUQesN1CO0TiIlSysAvrM3GxDjv-2oBwBn6hJLcMD9y69_IEluF_X2RPOQPGNCykUWhSfoMqHGgnSWFdqtVqz47jyMF2H5zgQW6iAc1wJOdly6kd9iACG6eh63eODCligjbrCMHrxqDnwT_V-Cx8XkDQTJ4x79s_A4-AaqbVwpDfnsg5S5xI68xihn2uVo6WEH_zHNDTyVsoI8iFH8wPZCzFLn-VSCf_-3BVMOE-fc3bsKJRh47TsFcskX_AfAAtDlsa9Eo7pmShSS9OoI9r1phvUNHV6cTR6__rTxbx2dUDwrZXYSBsQTMjGSHM-q7T_US7KHJOTJ14oN5l12fD9LHJ3-oXKDrey6PgV7Fwy2EprjKKoyGLJig-7ehHaZqgLIIrTdymT2VtfWW_E25OxtFOCkmPR51TEypx3dE8_?></g></svg>